# 도메인 설계 문서

## 1. Member 도메인의 역할과 책임

### 역할
- **회원 정보 관리**: 중고거래 플랫폼의 사용자 계정 정보를 관리
- **인증 정보 제공**: 로그인을 위한 사용자 검증 정보 제공 (인증 로직은 제외, 단순 검증만)

### 책임
1. **회원 정보 저장 및 관리**
   - 사용자명(username), 이메일(email), 비밀번호(password), 닉네임(nickname) 관리
   - 회원 가입일(createdAt), 수정일(updatedAt) 추적

2. **중복 검증**
   - 이메일 중복 체크
   - 사용자명 중복 체크

3. **로그인 검증**
   - 이메일과 비밀번호로 사용자 존재 여부 확인
   - 로그인 성공 시 사용자 정보 반환 (비밀번호 제외)

4. **프로필 관리**
   - 본인 정보 조회
   - 본인 정보 수정 (닉네임, 이메일, 비밀번호)
   - 사용자명은 변경 불가 (불변 속성)

---

## 2. Post 도메인의 역할과 책임

### 역할
- **게시글 정보 관리**: 중고거래 게시글의 전체 생명주기 관리
- **게시글 검색 및 정렬**: 사용자가 원하는 게시글을 효율적으로 찾을 수 있도록 지원

### 책임
1. **게시글 정보 저장 및 관리**
   - 제목(title), 내용(content), 가격(price), 지역(location), 이미지(image) 관리
   - 작성자 정보(author, authorName) 관리
   - 작성일(createdAt), 수정일(updatedAt) 추적

2. **게시글 조회 기능**
   - 전체 게시글 목록 조회
   - 제목/내용 기반 검색 기능
   - 정렬 기능 (최신순, 오래된순, 가격 높은순, 가격 낮은순)
   - 특정 게시글 상세 조회

3. **작성자 권한 관리**
   - 게시글 작성 권한 (로그인한 사용자만)
   - 게시글 수정 권한 (작성자만)
   - 게시글 삭제 권한 (작성자만)

---

## 3. 각 도메인에서 제공해야 할 기능 목록 (CRUD 관점)

### Member 도메인

#### Create (생성)
- ✅ **회원가입** (`POST /api/auth/signup`)
  - 사용자명, 이메일, 비밀번호, 닉네임 입력
  - 이메일/사용자명 중복 검증
  - 비밀번호 확인 일치 검증
  - 회원 정보 생성 및 반환

#### Read (조회)
- ✅ **내 정보 조회** (`GET /api/users/me`)
  - 현재 로그인한 사용자의 정보 조회
  - 비밀번호는 응답에서 제외

#### Update (수정)
- ✅ **내 정보 수정** (`PUT /api/users/me`)
  - 닉네임 수정
  - 이메일 수정 (중복 검증 포함)
  - 비밀번호 변경 (선택사항, 현재 비밀번호 확인 필요)
  - 사용자명은 수정 불가

#### Delete (삭제)
- ❌ **회원 탈퇴**: 프론트엔드에서 사용하지 않으므로 구현 제외

#### 기타
- ✅ **로그인 검증** (`POST /api/auth/login`)
  - 이메일과 비밀번호로 사용자 검증
  - 성공 시 사용자 정보 및 토큰 반환
  - 인증 로직은 제외, 단순 검증만 수행

---

### Post 도메인

#### Create (생성)
- ✅ **게시글 작성** (`POST /api/posts`)
  - 제목, 내용, 가격, 지역, 이미지 URL 입력
  - 작성자 정보 자동 설정 (로그인한 사용자)
  - 작성일 자동 설정

#### Read (조회)
- ✅ **게시글 목록 조회** (`GET /api/posts`)
  - 전체 게시글 목록 반환
  - 검색 기능: 제목/내용 키워드 검색 (Query Parameter: `search`)
  - 정렬 기능: 최신순, 오래된순, 가격 높은순, 가격 낮은순 (Query Parameter: `sort`)
  
- ✅ **게시글 상세 조회** (`GET /api/posts/{id}`)
  - 특정 게시글의 상세 정보 조회
  - 존재하지 않는 게시글인 경우 404 에러

#### Update (수정)
- ✅ **게시글 수정** (`PUT /api/posts/{id}`)
  - 제목, 내용, 가격, 지역, 이미지 URL 수정
  - 작성자만 수정 가능 (권한 검증)
  - 수정일 자동 업데이트

#### Delete (삭제)
- ✅ **게시글 삭제** (`DELETE /api/posts/{id}`)
  - 게시글 삭제
  - 작성자만 삭제 가능 (권한 검증)

---

## 4. 도메인 간 관계

### Member ↔ Post 관계

```
Member (1) ────────< (N) Post
```

- **관계 유형**: 일대다 (One-to-Many)
- **설명**: 
  - 한 회원(Member)은 여러 게시글(Post)을 작성할 수 있음
  - 하나의 게시글(Post)은 한 명의 회원(Member)에 의해 작성됨
- **구현 방식**:
  - Post 엔티티에 `author` 필드로 Member의 ID를 참조
  - 외래키 관계는 설정하지 않음 (단순 참조만)
  - Member 삭제 시 Post 처리 정책: 구현 제외 (회원 탈퇴 기능 없음)

### 데이터 흐름
1. **게시글 작성 시**: 
   - 로그인한 사용자의 ID를 `author`로 저장
   - 사용자의 닉네임을 `authorName`으로 저장 (조회 성능 최적화)

2. **게시글 수정/삭제 시**:
   - 요청한 사용자의 ID와 게시글의 `author`를 비교하여 권한 검증

---

## 5. REST API 서버 관점에서 이 프로젝트의 핵심 목표 요약

### 핵심 목표

1. **프론트엔드 중심 설계**
   - React SPA에서 실제로 사용하는 기능만 구현
   - 불필요한 기능 제거로 코드 복잡도 최소화
   - 프론트엔드 요구사항에 최적화된 API 설계

2. **단순한 인증 구조**
   - 복잡한 인증/인가 로직 제외 (Spring Security 미사용)
   - 단순 로그인 검증만 수행 (이메일/비밀번호 매칭)
   - 사용자 식별은 헤더(`X-User-Id`)로 처리

3. **RESTful 원칙 준수**
   - HTTP 메서드 적절한 사용 (GET, POST, PUT, DELETE)
   - 리소스 중심 URL 설계 (`/api/posts`, `/api/users`)
   - 일관된 응답 형식 (`ApiResponse<T>`)

4. **프론트엔드 사용성 최우선**
   - 검색 및 정렬 기능 제공으로 사용자 경험 향상
   - 명확한 에러 메시지 제공
   - CORS 설정으로 개발 환경 연동 용이

5. **데이터 무결성 보장**
   - 입력 데이터 유효성 검증 (Bean Validation)
   - 비즈니스 규칙 검증 (중복 체크, 권한 검증)
   - 일관된 예외 처리

6. **개발 편의성**
   - 샘플 데이터 자동 초기화
   - H2 인메모리 DB로 빠른 개발/테스트
   - 명확한 API 문서화

### 제외된 기능 (의도적 제외)

- ❌ 회원 탈퇴 기능
- ❌ 회원 목록 조회 기능
- ❌ 다른 사용자 프로필 조회 기능
- ❌ 게시글 좋아요/댓글 기능
- ❌ 복잡한 인증/인가 (JWT, OAuth 등)
- ❌ 파일 업로드 기능 (이미지는 URL로만 관리)
- ❌ 페이지네이션 (전체 목록 조회만 지원)

### 기술적 제약사항

- **인증 방식**: 헤더 기반 사용자 식별 (`X-User-Id`)
- **비밀번호 저장**: 평문 저장 (프로덕션 환경에서는 해시화 필요)
- **데이터베이스**: H2 인메모리 (재시작 시 데이터 초기화)
- **파일 저장**: 외부 이미지 URL 사용 (로컬 파일 저장 미지원)

---

## API 엔드포인트 요약

### 인증 (Authentication)
```
POST   /api/auth/signup    - 회원가입
POST   /api/auth/login     - 로그인
```

### 사용자 (User)
```
GET    /api/users/me       - 내 정보 조회
PUT    /api/users/me       - 내 정보 수정
```

### 게시글 (Post)
```
GET    /api/posts          - 게시글 목록 조회 (검색, 정렬)
GET    /api/posts/{id}     - 게시글 상세 조회
POST   /api/posts          - 게시글 작성
PUT    /api/posts/{id}     - 게시글 수정
DELETE /api/posts/{id}     - 게시글 삭제
```

---

## 데이터 모델 요약

### Member 엔티티
```java
- id: Long (PK, 자동생성)
- username: String (고유, 불변)
- email: String (고유)
- password: String
- nickname: String
- createdAt: LocalDateTime (자동생성)
- updatedAt: LocalDateTime (자동업데이트)
```

### Post 엔티티
```java
- id: Long (PK, 자동생성)
- title: String
- content: String (TEXT)
- price: Long (nullable)
- location: String (nullable)
- image: String (nullable, URL)
- author: Long (Member ID 참조)
- authorName: String (Member 닉네임, 조회 최적화)
- createdAt: LocalDateTime (자동생성)
- updatedAt: LocalDateTime (자동업데이트)
```

